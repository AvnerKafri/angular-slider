/*
 angular-slider v0.2.0 
 (c) 2013-2014 Venturocket, Inc. http://github.com/Venturocket 
 License: MIT 
*/
window.AngularSlider={rangeInputs:function(a){var b=document.createElement("input");if(b.setAttribute("type","range"),"text"===b.type)return!1;if(b.value=":)",b.style.cssText="position:absolute;visibility:hidden;",void 0!==b.style.WebkitAppearance){var c=a.documentElement,d=a.defaultView;c.appendChild(b);var e=d.getComputedStyle&&"textfield"!==d.getComputedStyle(b,null).WebkitAppearance&&0!==b.offsetHeight;return c.removeChild(b),e}return!1}(this.document)},angular.module("vr.directives.slider",["ngTouch"]).directive("slider",["$timeout","$document","$interpolate","$swipe",function(a,b,c,d){function e(a){return angular.element(a)}function f(a){return""+a+"px"}function g(a,b){return a.css({opacity:b})}function h(a){return g(a,0)}function i(a){return g(a,1)}function j(a,b){return a.css({left:b})}function k(a){var b=parseFloat(a.css("width"));return isNaN(b)?a[0].offsetWidth:b}function l(a){return k(a)/2}function m(a){try{return a.offset().left}catch(b){}return a[0].getBoundingClientRect().left}function n(a,b){return m(a)>m(b)?m(a)-m(b)-k(b):m(b)-m(a)-k(a)}function o(a,b){return a.attr("ng-bind-template",b)}function p(a,b,c,d,e){(angular.isUndefined(b)||!b)&&(b=0),(angular.isUndefined(c)||!c||0==c)&&(c=1/Math.pow(10,b)),(angular.isUndefined(d)||!d)&&(d=0),(angular.isUndefined(a)||!a)&&(a=0);var f=(a-d)%c,g=f>c/2?a+c-f:a-f;return(angular.isUndefined(e)||!e)&&(e=g),g=Math.min(Math.max(g,d),e),parseFloat(g.toFixed(b))}function q(a,b){return a>0&&!isNaN(b)?Math.ceil(b/a)*a:b}function r(a){return t+" "+a+" "+u}var s=3,t=c.startSymbol(),u=c.endSymbol();return{restrict:"EA",scope:{floor:"@",ceiling:"@",step:"@",precision:"@",buffer:"@",stickiness:"@",showSteps:"@",ngModel:"=",ngModelLow:"=",ngModelHigh:"=",translate:"&",translateRange:"&",translateCombined:"&",scale:"&",inverseScale:"&"},template:"<span class='bar full'></span><span class='bar steps'><span class='bubble step' ng-repeat='step in stepBubbles()'></span></span><span class='bar selection'></span><span class='bar unselected low'></span><span class='bar unselected high'></span><span class='pointer low'></span><span class='pointer high'></span><span class='bubble low'></span><span class='bubble high'></span><span class='bubble middle'></span><span class='bubble selection'></span><span class='bubble limit floor'></span><span class='bubble limit ceiling'></span><input type='range' class='input low' /><input type='range' class='input high' /><input type='range' class='input selection' />",compile:function(c,g){function t(a){a||(a=c);var b=[];return angular.forEach(a.children(),function(a){b.push(e(a))}),b}function u(a,b,c){return{fullBar:a[0],stepBubs:a[1],selBar:b?a[2]:null,unSelBarLow:b?a[3]:null,unSelBarHigh:b?a[4]:null,minPtr:b?a[5]:a[2],maxPtr:b?a[6]:null,lowBub:b?a[7]:a[3],highBub:b?a[8]:null,cmbBub:b?a[9]:null,selBub:b?a[10]:null,flrBub:b?a[11]:a[4],ceilBub:b?a[12]:a[5],minInput:c?b?a[13]:a[6]:null,maxInput:c?b?a[14]:null:null,selInput:c?b?a[15]:null:null}}var v=g.showSteps,w=null==g.ngModel&&null!=g.ngModelLow&&null!=g.ngModelHigh,x={},y=w?"ngModelLow":"ngModel",z="ngModelHigh",A="selectBar",B=["floor","ceiling","stickiness",y];if(x=function(){for(var a=t(),b=[],c=0,d=a.length;d>c;c++){var f=a[c];f=e(f),f.css({"white-space":"nowrap",position:"absolute",display:"block","z-index":1}),b.push(f)}return b}(),x=u(x,!0,!0),g.translate&&g.$set("translate",""+g.translate+"(value)"),g.translateRange&&g.$set("translateRange",""+g.translateRange+"(low,high)"),g.translateCombined&&g.$set("translateCenter",""+g.translateCombined+"(low,high)"),g.scale&&g.$set("scale",""+g.scale+"(value)"),g.inverseScale&&g.$set("inverseScale",""+g.inverseScale+"(value)"),x.fullBar.css({left:0,right:0}),AngularSlider.rangeInputs){var C={position:"absolute",margin:0,padding:0,opacity:0,height:"100%"};x.minInput.attr("step",r("inputSteps()")),x.minInput.attr("min",r("floor")),x.minInput.css(C),x.minInput.css("left",0),w?(x.minInput.attr("max",r("ngModelHigh - (buffer / 2)")),x.maxInput.attr("step",r("inputSteps()")),x.maxInput.attr("min",r("ngModelLow + (buffer / 2)")),x.maxInput.attr("max",r("ceiling")),x.maxInput.css(C),x.selInput.attr("step",r("inputSteps()")),x.selInput.attr("min",r("ngModelLow")),x.selInput.attr("max",r("ngModelHigh")),x.selInput.css(C)):(x.minInput.attr("max",r("ceiling")),x.minInput.css({width:"100%"}),x.maxInput.remove(),x.selInput.remove())}else x.minInput.remove(),x.maxInput.remove(),x.selInput.remove();if(o(x.stepBubs.children().eq(0),r("translation(step)")),o(x.ceilBub,r("translation(ceiling)")),o(x.flrBub,r("translation(floor)")),o(x.selBub,r("rangeTranslation("+y+","+z+")")),o(x.lowBub,r("translation("+y+")")),o(x.highBub,r("translation("+z+")")),o(x.cmbBub,r("combinedTranslation("+y+","+z+")")),w)B.push(z),B.unshift("buffer");else for(var D=[x.selBar,x.unSelBarLow,x.unSelBarHigh,x.maxPtr,x.selBub,x.highBub,x.cmbBub],E=0,F=D.length;F>E;E++)c=D[E],c.remove();return B.unshift("precision","step"),v||x.stepBubs.children().remove(),{post:function(c,g,o){function r(){if(angular.forEach(B,function(a){c[a]=parseFloat(c[a]),a==y||a==z?c[a]=p(c[a],c.precision,c.step,c.floor,c.ceiling):"buffer"==a?c.buffer=q(c.step,c.buffer):"precision"==a?c.precision=!c.precision||isNaN(c.precision)?0:parseInt(c.precision):"step"==a?c.step=!c.step||isNaN(c.step)?1/Math.pow(10,c.precision):parseFloat(c.step.toFixed(c.precision)):"stickiness"==a&&(isNaN(c.stickiness)?c.stickiness=s:c.stickiness<1&&(c.stickiness=1)),c.decodedValues[a]=c.decodeRef(a)}),w){if(c[z]<c[y]){var a=c[z];c[z]=c[y],c[y]=a}var b=p(c[z]-c[y],c.precision,c.step);if(c.buffer>0&&b<c.buffer){var d=c.encode((c.decodedValues[y]+c.decodedValues[z])/2);c[y]=p(d-c.buffer/2,c.precision,c.step,c.floor,c.ceiling),c[z]=c[y]+c.buffer,c[z]>c.ceiling&&(c[z]=c.ceiling,c[y]=c.ceiling-c.buffer)}}C=k(x.fullBar),D=l(x.minPtr),E=m(x.fullBar),F=E+C-k(x.minPtr),G=F-E,H=c.floor,I=c.decodedValues.floor,J=c.ceiling,K=c.decodedValues.ceiling,L=J-H,M=K-I}function v(){function a(a){return 100*((a-E)/G)}function o(b){return a(b)/100*M+I}function q(a){return c.encode(o(a))}function s(a){return 100*((a-I)/M)}function t(a){return s(c.decode(a))}function u(a){return f(a*G/100)}function v(a){return Math.min(Math.max(a,E),F)}function B(b){return j(b,u(a(v(m(b)))))}function K(a,b,d){var e=a>0?1:-1;return b=b?b:100,d?(Math.sin(Math.min(Math.abs(a/b),1)*Math.PI-Math.PI/2)+1)*e*b/6:e*Math.pow(Math.min(Math.abs(2*(a/b)),1),c.stickiness)*b/2}function L(){var b=s(c.decodedValues[y]),d=t(c[y]+c.step)-b,e=b-t(c[y]-c.step),f=t(c[y]+c.buffer)-b,g=a(D+E),h=b+K(N,N>0?d:e);if(j(x.minPtr,u(h)),j(x.lowBub,u(a(m(x.minPtr)-l(x.lowBub)+D))),w){var i=s(c.decodedValues[z]),k=t(c[z]+c.step)-i,n=i-t(c[z]-c.step),o=i-t(c[z]-c.buffer),p=i+K(O,O>0?k:n);if(h>i-o&&(h=b+K(N,f,!0),j(x.minPtr,u(h)),j(x.lowBub,u(a(m(x.minPtr)-l(x.lowBub)+D)))),b+f>p&&(p=i+K(O,o,!0)),j(x.maxPtr,u(p)),j(x.highBub,u(a(m(x.maxPtr)-l(x.highBub)+D))),j(x.selBar,u(h+g)),x.selBar.css({width:u(p-h)}),j(x.selBub,u(h+a(l(x.selBar)-l(x.selBub)+E))),j(x.cmbBub,u(h+a(l(x.selBar)-l(x.cmbBub)+E))),x.unSelBarLow.css({left:0,width:u(h+g)}),j(x.unSelBarHigh,u(p+g)),x.unSelBarHigh.css({right:0}),AngularSlider.rangeInputs){var q=h+f/2;x.minInput.css({width:u(p-f/2)}),x.maxInput.css({left:u(q+2*g),width:u(100-q)}),x.selInput.css({left:u(h+2*g),width:u(p-h-2*g)})}}}function Q(){var a=x.lowBub;B(x.lowBub),w&&(B(x.highBub),B(x.selBub),n(x.lowBub,x.highBub)<10?(h(x.lowBub),h(x.highBub),i(x.cmbBub),B(x.cmbBub),a=x.cmbBub):(i(x.lowBub),i(x.highBub),h(x.cmbBub),a=x.highBub)),n(x.flrBub,x.lowBub)<5?h(x.flrBub):w?n(x.flrBub,a)<5?h(x.flrBub):i(x.flrBub):i(x.flrBub),n(x.lowBub,x.ceilBub)<5?h(x.ceilBub):w?n(a,x.ceilBub)<5?h(x.ceilBub):i(x.ceilBub):i(x.ceilBub)}function R(){N=0,O=0,Y&&(L(),Q(),Y.removeClass("active")),Y=null,Z=null,V=!1}function S(b){Y&&c.$apply(function(){var d=b.clientX||b.x;if(V){var e=q(d)-W,f=q(d)+X;H>e?(f+=H-e,e=H):f>J&&(e-=f-J,f=J);var h=t(e),i=t(f);N=h,O=i,c[y]=e=p(e,c.precision,c.step,c.floor,c.ceiling),c[z]=f=p(f,c.precision,c.step,c.floor,c.ceiling),N-=t(e),O-=t(f)}else{var j=v(d+E-m(g)-l(Y)),k=a(j),n=c.encode(I+M*k/100);N=k,w&&(c.buffer>0?Z===y?n>c[z]-c.buffer&&(n=c[z]-c.buffer):n<c[y]+c.buffer&&(n=c[y]+c.buffer):Z===y?n>c[z]&&(c[y]=c[z],Z=z,x.minPtr.removeClass("active"),x.maxPtr.addClass("active")):n<c[y]&&(c[z]=c[y],Z=y,x.maxPtr.removeClass("active"),x.minPtr.addClass("active"))),c[Z]=n=p(n,c.precision,c.step,c.floor,c.ceiling),Z===y?N-=t(n):(O=N-t(n),N=0)}L(),Q()})}function T(b,d,e){Y=d,Z=e,Y.addClass("active");var f=b.clientX||b.x,h=I+M*a(v(f+E-m(g)))/100;if(Z==A){V=!0;var i=q(f);W=i-c[y],X=c[z]-i}c[Z]=p(c.encode(h),c.precision,c.step,c.floor,c.ceiling),L(),Q(),c.$apply(),r()}function U(){function a(a,b,c){function f(a){T(a,b,c)}function g(a){S(a),R()}a=e(a),window.navigator.pointerEnabled?a.on("pointerdown",f).on("pointermove",S).on("pointerup",g).on("pointercancel",R):window.navigator.msPointerEnabled?a.on("MSPointerDown",f).on("MSPointerMove",S).on("MSPointerUp",g).on("MSPointerCancel",R):d.bind(a,{start:f,move:S,end:g,cancel:R})}function c(a,b,c){a=e(a),c=angular.isUndefined(c)?a:e(c),d.bind(a,{start:function(a){T(a,c,b)}})}function f(a){a=e(a),d.bind(a,{move:S,end:function(a){S(a),R()},cancel:R})}AngularSlider.rangeInputs?(a(x.minInput,x.minPtr,y),w&&(a(x.maxInput,x.maxPtr,z),a(x.selInput,x.selBar,A))):(f(b),c(x.minPtr,y),c(x.lowBub,y),c(x.flrBub,y,x.minPtr),w?(c(x.maxPtr,z),c(x.highBub,z),c(x.ceilBub,z,x.maxPtr),c(x.selBar,A),c(x.selBub,A,x.selBar),c(x.unSelBarLow,y,x.minPtr),c(x.unSelBarHigh,z,x.maxPtr)):(c(x.ceilBub,y,x.minPtr),c(x.fullBar,y,x.minPtr)))}var V,W,X,Y,Z;r(),j(x.flrBub,0),j(x.ceilBub,f(C-k(x.ceilBub))),L(),Q(),P||(U(),P=!0)}var x=u(t(g),w,AngularSlider.rangeInputs);c.decodedValues={floor:0,ceiling:0,step:0,precision:0,buffer:0,stickiness:0,ngModel:0,ngModelLow:0,ngModelHigh:0},c.translation=function(a){return a=parseFloat(a).toFixed(c.precision),angular.isUndefined(o.translate)?""+a:c.translate({value:a})},c.rangeTranslation=function(a,b){return a=parseFloat(a).toFixed(c.precision),b=parseFloat(b).toFixed(c.precision),angular.isUndefined(o.translateRange)?"Range: "+c.translate({value:parseFloat((b-a).toFixed(c.precision))}):c.translateRange({low:a,high:b})},c.combinedTranslation=function(a,b){return a=parseFloat(a).toFixed(c.precision),b=parseFloat(b).toFixed(c.precision),angular.isUndefined(o.translateRange)?c.translate({value:a})+" - "+c.translate({value:b}):c.translateCombined({low:a,high:b})},c.encode=function(a){return angular.isUndefined(o.scale)||""==o.scale?a:c.scale({value:a})},c.decode=function(a){return angular.isUndefined(o.inverseScale)||""==o.inverseScale?a:c.inverseScale({value:a})},(1!=Math.round(c.encode(c.decode(1)))||100!=Math.round(c.encode(c.decode(100))))&&console.warn("The scale and inverseScale functions are not perfect inverses: 1 = "+c.encode(c.decode(1))+"  100 = "+c.encode(c.decode(100))),c.decodeRef=function(a){return c.decode(c[a])},c.inputSteps=function(){return Math.pow(10,-1*c.precision)};for(var C=0,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=!1,Q=0;Q<B.length;Q++)c.$watch(B[Q],function(){v()});e(window).bind("resize",function(){v()}),c.$on("refreshSlider",function(){a(function(){v()})}),a(function(){v()})}}}}}]);