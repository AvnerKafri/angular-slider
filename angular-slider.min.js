/*
 angular-slider v1.0.0-beta.1 
 (c) 2013-2014 Venturocket, Inc. http://github.com/Venturocket 
 License: MIT 
*/
angular.module("vr.directives.slider",[]),angular.module("vr.directives.slider").controller("SliderCtrl",["$scope","$element",function(a,b){function c(){a.knobs.sort(function(a,b){var c=a.ngModel.$modelValue,d=b.ngModel.$modelValue;return c>d?1:d>c?-1:0})}function d(){a.bars.push({low:function(){return 0},high:function(){return 0}})}function e(){a.bars.splice(0,1)}function f(){function b(b){return function(){return b>0?a.knobs[b-1].ngModel.$modelValue:a.floor}}function c(b){return function(){return b<a.knobs.length?a.knobs[b].ngModel.$modelValue:a.ceiling}}for(var f=a.knobs.length;a.bars.length<f+1;)d();for(;a.bars.length>f+1;)e();angular.forEach(a.bars,function(a,d){a.low=b(d),a.high=c(d)}),angular.forEach(g,function(b,c){b.scope.lowKnob=c>0?a.knobs[c-1].elem:null,b.scope.highKnob=c<a.knobs.length?a.knobs[c].elem:null,b.onChange&&b.onChange()})}a.knobs=[],a.bars=[];var g=[];a.currentKnob=null,a.sliding=!1,this.options={precision:0,buffer:0,steps:0,addStepNumbers:!1,stickiness:3,scale:function(a){return a},continuous:!1,vertical:!1};var h=this.options;a.dimensions=function(){return{sliderSize:h.vertical?b[0].offsetHeight:b[0].offsetWidth,sliderOffset:h.vertical?b[0].offsetTop:b[0].offsetLeft}},a.fix=function(){c(),f()},this.valueToPercent=function(b,c,d){var e=0;c&&(e=this.options.vertical?c[0].offsetHeight:c[0].offsetWidth);var f=e/a.dimensions().sliderSize*100,g=(parseFloat(b)-a.floor)/(a.ceiling-a.floor)*(100-f);return d&&c&&(g+=f/2),g},this.registerKnob=function(b){function c(c){c=parseFloat(c);var d=a.ceiling,e=a.floor,f=c,g=a.knobs.indexOf(b);if(h.continuous||(g>0&&(e=parseFloat(a.knobs[g-1].ngModel.$modelValue)+(h.buffer>0?h.buffer:0)),g<a.knobs.length-1&&(d=parseFloat(a.knobs[g+1].ngModel.$modelValue)-(h.buffer>0?h.buffer:0))),h.steps>1){var i=(a.ceiling-a.floor)/(h.steps-1);if(g>0){var j=(e-a.floor)%i;j>0&&(e+=i-j)}if(g<a.knobs.length-1){var k=(d-a.floor)%i;k>0&&(d-=k)}var l=(f-a.floor)%i;i/2>l?f-=l:f+=i-l}f=Math.min(d,Math.max(f,e)),h.precision>=0&&(f=parseFloat(f.toFixed(h.precision))),f==c?b.onChange&&b.onChange(c):isNaN(f)||(b.ngModel.$setViewValue(f),a.$$phase||a.$apply())}function d(b){e&&(c(b),a.fix(),a.$$phase||a.$apply())}var e=!0;return a.knobs.push(b),a.$watch(function(){return b.ngModel.$modelValue},function(a){d(a)}),a.$watch("floor",function(){d(b.ngModel.$modelValue)}),a.$watch("ceiling",function(){d(b.ngModel.$modelValue)}),a.$watch(function(){return h},function(){d(b.ngModel.$modelValue)},!0),f(),b.elem.on("$destroy",function(){a.knobs.splice(a.knobs.indexOf(b),1),e=!1}),{start:function(c){a.sliding||a.disabled||(a.currentKnob=b,a.sliding=!0,a.onStart(c),b.onStart())},disabled:function(){a.sliding&&a.currentKnob==b&&a.onEnd()}}},this.registerBar=function(a){g.push(a),a.elem.on("$destroy",function(){var b=g.indexOf(a);b>=0&&g.splice(b,1)})}}]),angular.module("vr.directives.slider").directive("ngSlider",["$document","$compile",function(a,b){return{restrict:"EA",controller:"SliderCtrl",scope:!0,compile:function(c,d){if(angular.isUndefined(d.floor))throw"ngSlider Error: Floor not specified";if(angular.isUndefined(d.ceiling))throw"ngSlider Error: Ceiling not specified";return c.addClass("ng-slider"),function(c,d,e,f){d.prepend(b("<ng-slider-bar low='{{ bar.low() }}' high='{{ bar.high() }}' ng-repeat='bar in bars'></ng-slider-bar>")(c)),c.onStart=function(a){onMove(a)},c.onMove=function(a){var b=c.dimensions(),d=(f.options.vertical?a.clientY:a.clientX)-c.dimensions().sliderOffset,e=f.options.vertical?c.currentKnob.elem[0].offsetHeight:c.currentKnob.elem[0].offsetWidth,g=Math.max(0,Math.min((d-e/2)/(b.sliderSize-e),1)),h=(g*(c.ceiling-c.floor)+c.floor).toFixed(f.options.precision);c.currentKnob.ngModel.$setViewValue(h),c.$$phase||c.$apply()},c.onEnd=function(){c.sliding=!1,c.currentKnob.onEnd()};var g=["mousemove","touchmove"],h=["mousecancel","touchcancel"],i=["mouseup","touchend"];window.PointerEvent?(g=["pointermove"],h=["pointercancel"],i=["pointerup"]):window.navigator.msPointerEnabled&&(g=["MSPointerMove"],h=["MSPointerCancel"],i=["MSPointerUp"]),angular.forEach(g,function(b){a.bind(b,function(a){c.sliding&&(a.preventDefault(),c.onMove(a))})}),angular.forEach(h.concat(i),function(b){a.bind(b,function(){c.sliding&&c.onEnd()})}),c.$watch(function(){return c.$eval(e.ngDisabled)},function(a){c.disabled=angular.isDefined(a)&&a,c.disabled?d.addClass("disabled"):d.removeClass("disabled"),c.sliding&&onEnd()}),e.$observe("ceiling",function(a){a=angular.isDefined(a)?parseFloat(a):0,c.ceiling=isNaN(a)?0:a}),e.$observe("floor",function(a){a=angular.isDefined(a)?parseFloat(a):0,c.floor=isNaN(a)?0:a}),c.$watch(function(){return c.$eval(e.ngSliderOptions)},function(a){angular.extend(f.options,angular.isDefined(a)&&angular.isObject(a)?a:{}),f.options.vertical?d.addClass("ng-slider-vertical").removeClass("ng-slider-horizontal"):d.addClass("ng-slider-horizontal").removeClass("ng-slider-vertical")},!0)}}}}]).directive("ngSliderKnob",["$parse",function(a){return{restrict:"EA",require:["^ngSlider","^ngModel"],scope:!0,compile:function(b,c){if(angular.isUndefined(c.ngModel))throw"ngSliderKnob Error: ngModel not specified";return b.addClass("ng-slider-knob"),function(b,c,d,e){function f(c){a(d.ngModel).assign(b.$parent.$parent,c),b.$$phase||b.$apply()}var g=e[0],h=e[1],i=!0,j=g.registerKnob({ngModel:h,elem:c,onChange:function(a){f(a),b.$viewValue=a,c.css(g.options.vertical?"top":"left",g.valueToPercent(a,c)+"%")},onStart:function(){c.addClass("active")},onEnd:function(){c.removeClass("active")}});b.$watch(function(){return b.$eval(d.ngDisabled)},function(a){i=!a,a?c.addClass("disabled"):c.removeClass("disabled"),j.disabled()});var k=["mousedown","touchstart"];window.PointerEvent?k=["pointerdown"]:window.navigator.MSPointerEnabled&&(k=["MSPointerDown"]),angular.forEach(k,function(a){c.bind(a,function(a){a.preventDefault(),j.start(a)})})}}}}]).directive("ngSliderBar",function(){return{restrict:"EA",require:"^ngSlider",compile:function(a){return a.addClass("ng-slider-bar"),function(a,b,c,d){function e(){var c=d.valueToPercent(a.low,a.lowKnob,!0),e=d.valueToPercent(a.high,a.highKnob,!0)-c;b.css(d.options.vertical?"top":"left",c+"%"),b.css(d.options.vertical?"height":"width",e+"%")}a.low=0,a.high=0,a.lowKnob=null,a.highKnob=null,d.registerBar({elem:b,scope:a,onChange:function(){e()}}),c.$observe("low",function(b){a.low=b,e()}),c.$observe("high",function(b){a.high=b,e()})}}}});